---
title:  "mysql各种log"
date:   2024-01-08 19:56:26 +0800
categories: mysql
---
# 1、bin log
## 1.1、作用
binlog记录了改变数据状态操作的二进制文件，主要用户数据的复制和恢复。
## 1.2、格式
1. 如何查询binlog的格式?
```sql
mysql> show global variables like "binlog%"
+------------------------------------------------+--------------+
| Variable_name                                  | Value        |
+------------------------------------------------+--------------+
| binlog_cache_size                              | 32768        |
| binlog_checksum                                | CRC32        |
| binlog_direct_non_transactional_updates        | OFF          |
| binlog_encryption                              | OFF          |
| binlog_error_action                            | ABORT_SERVER |
| binlog_expire_logs_auto_purge                  | ON           |
| binlog_expire_logs_seconds                     | 2592000      |
| binlog_format                                  | ROW          |
| binlog_group_commit_sync_delay                 | 0            |
| binlog_group_commit_sync_no_delay_count        | 0            |
| binlog_gtid_simple_recovery                    | ON           |
| binlog_max_flush_queue_time                    | 0            |
| binlog_order_commits                           | ON           |
| binlog_rotate_encryption_master_key_at_startup | OFF          |
| binlog_row_event_max_size                      | 8192         |
| binlog_row_image                               | FULL         |
| binlog_row_metadata                            | MINIMAL      |
| binlog_row_value_options                       |              |
| binlog_rows_query_log_events                   | OFF          |
| binlog_stmt_cache_size                         | 32768        |
| binlog_transaction_compression                 | OFF          |
| binlog_transaction_compression_level_zstd      | 3            |
| binlog_transaction_dependency_history_size     | 25000        |
| binlog_transaction_dependency_tracking         | COMMIT_ORDER |
+------------------------------------------------+--------------+
```


### 1.2.1、STATEMENT
每一条修改数据的sql都会记录在binlog中。
- 优点
> 实现简单，日志紧凑
- 缺点
> 操作数据的Sql存在部分函数，可能导致同步后数据不一致。比如sql使用NOW()等函数

### 1.2.2、RAW
raw格式只会记录每一行的详细操作。
- 优点
> 清晰明了，准确
- 缺点
> 因为是行级别的日志记录，日志占用空间大，数据同步耗时长。

### 1.2.3、MIXED
mixed以statement为主要格式记录数据变更，只有在使用部分函数导致数据同步不一致时才会使用raw格式。


# 2、redo log
## 2.1、作用
Redo Log(重做日志)主要用于数据库宕机后，重启数据库时，恢复已经提交事务的变更到数据存储文件。

## 2.2、特点
1. 重做日志的存储是环形
2. WAL(Write Ahead Log)保证变更先写入重做日志
3. 重写日志缓冲区:主要提供写入重写日志的效率，先将变更写入重写日志缓冲区，然后异步将变更刷新到重做日志文件
4. 重做日志是顺序写入


# undo log

